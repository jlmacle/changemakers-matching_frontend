<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css"  href="../_css/common.css"> 
    <link rel="stylesheet" type="text/css"  href="../_css/authentication.css">
    <link rel="stylesheet" type="text/css"  href="../_css/project-view.css">
    <title>Looking to change the world? Find if your skills could be used to achieve the UN Sustainable Development Goals.</title>
    <!-- "OWASP recommends DOMPurify or the Sanitizer API for HTML sanitization." -->
    <!-- https://cheatsheetseries.owasp.org/cheatsheets/DOM_Clobbering_Prevention_Cheat_Sheet.html#mitigation-techniques -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js" integrity="sha512-5g2Nj3mqLOgClHi20oat1COW7jWvf7SyqnvwWUsMDwhjHeqeTl0C+uzjucLweruQxHbhDwiPLXlm8HBO0011pA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Integrity confirmed to be correct with https://www.srihash.org/. Couldn't do the same with Get-FileHash. Need to understand why. -->
    <script src="../_js/common.js"></script>
    <script type="module" src="../_js/project_view.js"></script>
    <!-- TODO file hash to add to the scripts -->
</head>
<body>
    <header id="header">        
        <div id="header-title-container">
            <a id="home-link" href="./index.html" title="Link to the homepage">
                <div class="header-title">Looking&nbsp;</div>
                <div class="header-title">to be&nbsp;</div>
                <div class="header-title">involved&nbsp;</div>
                <div class="header-title"> in&nbsp;</div>
                <div class="header-title"> SDG pr
                <img id="header-sdg-wheel" src="../_media/UN-graphics/SDG-Wheel-Transparent-WEB.png" alt="UN SDG Wheel" style="padding:0px;margin-left:-5px;margin-right:-5px;"/>
                jects?</div>   
            </a>       
        </div>
    </header>
    <main id="main">
        <script>
            
            // https://www.w3schools.com/js/tryit.asp?filename=tryjs_function_expression_self
            function fetch_user() 
            {   
                event.preventDefault(); // to avoid unexpected network behaviors causing network errors
                const file = "http://127.0.0.1:8080/representatives/new-account"
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;                           

                if (!username || !password) // if username or password are empty or null
                {
                    document.getElementById("auth-form-submit").disabled = false;
                    console.log("username or password are empty. Treated in HTML page.");
                }
                else{
                    console.log("Entering fetch_user() function");
                    fetch (file, {
                        method:'POST', 
                        headers: {'Content-Type': 'application/json'}, 
                        body: JSON.stringify({username: username, password: password})
                    })
                    .then(response => response.text())
                    .then(string_to_sanitize => {                 
                        //Toggling the visibility of the authentication form
                        document.getElementById("data-entry_new-account_proj-rep").style.display = "none";
                        
                        //TODO: from JSON string data to object to stylizable HTML
                        // "you can sanitize strings by executing the following code:"
                        // https://www.npmjs.com/package/dompurify
                        string_to_sanitize = string_to_sanitize.replace(',',',<br>'); // to allow a line break for the data
                        const sanitized_string = DOMPurify.sanitize(string_to_sanitize);                           
                        
                        // Welcome message
                        document.getElementById("welcome").innerHTML = "Welcome, " + username;

                        // Toggling the visibility of the project main content
                        document.getElementById("projects-main-content").style.display = "block";


                        })
                    .catch(error => console.log(error));
            }
            }
            
        </script>
        
        <div id="data-entry_new-account_proj-rep" style="text-align: center;display:block;">
            <h1 id="txt_account_creation" style="display:block;">New account creation</h1>
            <form id="auth-form" style="display: block;">
                <fieldset>
                    <legend>Please enter username and password</legend>
                    <label for="username">Username</label>
                    <input type="text" name="username" id="username" oninput="checkUsername(event)" autocomplete="off">
                    <!--TODO: autocomplete="off" to remove eventually. A help with demos-->
                    <div id="username_error">The username can only contain unaccented letters, numbers and underscores.</div>
                    <br>
                    <label for="password">Password</label>
                    <input type="password" name="password" id="password" oninput="checkPassword(event)"><br>
                    <div id="password_error">Password should be at least 8 characters long.</div>
                    <br>
                    <button type="submit" id="auth-form-submit" onclick="fetch_user()" disabled>Submit</button>            
                </fieldset>
            </form>
        </div>

        <div id="welcome"></div>
        <div id="projects-main-content" style="display:none;">            
            
            <h1 id="dashboard_proj-rep">Dashboard</h1>
            <div id="projects-list"><strong>Your projects</strong>
                <ul>
                    <li>You have no projects declared.</li>
                </ul>
            </div>

            <button tabindex="0" id="new-project-definition-invite-button" onclick='toggleElementVisibility("new-project-definition")'>                
                <strong>Click to declare a new project</strong></button>
            <form id="new-project-definition" style="display:none;" >
                
                <fieldset>
                    <legend>New project declaration</legend>
                    <div class="new-project-definition-container">
                        <label class="new-project-definition-label" for="project-name">Project name </label>
                        <textarea put class="new-project-definition-input" type="text" id="project-name" name="project-name" rows="1"></textarea><br>
                    </div>
                    <div class="new-project-definition-container">
                        <label class="new-project-definition-label" for="project-mission-statement">Project mission statement</label>
                        <textarea class="new-project-definition-input" size="2000" type="textarea" id="project-mission-statement" 
                            name="project-mission-statement" rows="5">
                        </textarea><br>
                    </div>
                    
                    <div class="new-project-definition-container">
                        <label class="new-project-definition-label" for="project-country">Country</label>
                        <select class="new-project-definition-input" id="project-country" name="project-country">
                            <!-- here the options  -->
                        </select>                        
                    </div>              
                    <br>
                    ...
                    <br>
                    ...
                    <br>
                    <button type="submit" id="new-proj-def-form-submit"  disabled>Submit</button>
                </fieldset>
            </form>            
        </div>


    </main>
    <footer id="footer">
        <span id="footer-left"><a href="">About</a></span>
        <span id="footer-right"><a href="">Privacy</a></span>
    </footer>

    
    
</body>
</html>